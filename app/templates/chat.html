{% extends "base.html" %}
{% block content %}
	<h1>Chat</h1>
	<div id="chatbox" class="chatbox"></div>
	<form id="chat-form" class="chat-form">
		<input id="chat-input" type="text" placeholder="Type your message..." required />
		<button type="submit">Send</button>
	</form>
	<script>
		const chatbox = document.getElementById('chatbox');
		const form = document.getElementById('chat-form');
		const input = document.getElementById('chat-input');

		function addMessage(role, text) {
			const div = document.createElement('div');
			div.className = 'msg ' + role;
			div.textContent = text;
			chatbox.appendChild(div);
			chatbox.scrollTop = chatbox.scrollHeight;
		}

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			const text = input.value.trim();
			if (!text) return;
			addMessage('user', text);
			input.value = '';
			try {
				const res = await fetch('/api/chat', {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({ messages: [{ role: 'user', content: text }] })
				});
				const data = await res.json();
				addMessage('assistant', data.reply || '(no reply)');
			} catch (err) {
				addMessage('assistant', 'Error: ' + err);
			}
		});
	</script>
{% endblock %}



